(()=>{var e={437:(e,t,n)=>{var r,o=function(e){var t="b",n="w",r=-1,o="p",i="k",s="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",u=["1-0","0-1","1/2-1/2","*"],a={b:[16,32,17,15],w:[-16,-32,-17,-15]},l={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},c=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],f=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],p={p:0,n:1,b:2,r:3,q:4,k:5},g={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},d={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},h={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},v={w:[{square:h.a1,flag:d.QSIDE_CASTLE},{square:h.h1,flag:d.KSIDE_CASTLE}],b:[{square:h.a8,flag:d.QSIDE_CASTLE},{square:h.h8,flag:d.KSIDE_CASTLE}]},m=new Array(128),y={w:r,b:r},b=n,w={w:0,b:0},S=r,E=0,C=1,_=[],A={},k={};function I(e){void 0===e&&(e=!1),m=new Array(128),y={w:r,b:r},b=n,w={w:0,b:0},S=r,E=0,C=1,_=[],e||(A={}),k={},L(x())}function R(){for(var e=[],t={},n=function(e){e in k&&(t[e]=k[e])};_.length>0;)e.push(z());for(n(x());e.length>0;)Y(e.pop()),n(x());k=t}function T(){P(s)}function P(e,o){void 0===o&&(o=!1);var i=e.split(/\s+/),s=i[0],u=0;if(!q(e).valid)return!1;I(o);for(var a=0;a<s.length;a++){var l=s.charAt(a);if("/"===l)u+=8;else if(-1!=="0123456789".indexOf(l))u+=parseInt(l,10);else{var c=l<"a"?n:t;O({type:l.toLowerCase(),color:c},J(u)),u++}}return b=i[1],i[2].indexOf("K")>-1&&(w.w|=d.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(w.w|=d.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(w.b|=d.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(w.b|=d.QSIDE_CASTLE),S="-"===i[3]?r:h[i[3]],E=parseInt(i[4],10),C=parseInt(i[5],10),L(x()),!0}function q(e){var t=e.split(/\s+/);if(6!==t.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(t[5])||parseInt(t[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(t[4])||parseInt(t[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(t[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(t[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var n=t[0].split("/");if(8!==n.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var r=0;r<n.length;r++){for(var o=0,i=!1,s=0;s<n[r].length;s++)if(isNaN(n[r][s])){if(!/^[prnbqkPRNBQK]$/.test(n[r][s]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};o+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};o+=parseInt(n[r][s],10),i=!0}if(8!==o)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function x(){for(var e=0,t="",o=h.a8;o<=h.h1;o++){if(null==m[o])e++;else{e>0&&(t+=e,e=0);var i=m[o].color,s=m[o].type;t+=i===n?s.toUpperCase():s.toLowerCase()}o+1&136&&(e>0&&(t+=e),o!==h.h1&&(t+="/"),e=0,o+=8)}var u="";w.w&d.KSIDE_CASTLE&&(u+="K"),w.w&d.QSIDE_CASTLE&&(u+="Q"),w.b&d.KSIDE_CASTLE&&(u+="k"),w.b&d.QSIDE_CASTLE&&(u+="q"),u=u||"-";var a=S===r?"-":J(S);return[t,b,u,a,E,C].join(" ")}function M(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(A[e[t]]=e[t+1]);return A}function L(e){_.length>0||(e!==s?(A.SetUp="1",A.FEN=e):(delete A.SetUp,delete A.FEN))}function N(e){var t=m[h[e]];return t?{type:t.type,color:t.color}:null}function O(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in h))return!1;var n=h[t];return(e.type!=i||y[e.color]==r||y[e.color]==n)&&(m[n]={type:e.type,color:e.color},e.type===i&&(y[e.color]=n),L(x()),!0)}function D(e,t,n,r,i){var s={color:b,from:t,to:n,flags:r,piece:e[t].type};return i&&(s.flags|=d.PROMOTION,s.promotion=i),e[n]?s.captured=e[n].type:r&d.EP_CAPTURE&&(s.captured=o),s}function U(e){function t(e,t,n,r,i){if(e[n].type!==o||0!==Z(r)&&7!==Z(r))t.push(D(e,n,r,i));else for(var s=["q","r","b","n"],u=0,a=s.length;u<a;u++)t.push(D(e,n,r,i,s[u]))}var n=[],r=b,s=ee(r),u={b:1,w:6},c=h.a8,f=h.h1,p=!1,g=void 0===e||!("legal"in e)||e.legal,v=void 0===e||!("piece"in e)||"string"!=typeof e.piece||e.piece.toLowerCase();if(void 0!==e&&"square"in e){if(!(e.square in h))return[];c=f=h[e.square],p=!0}for(var E=c;E<=f;E++)if(136&E)E+=7;else{var C=m[E];if(null!=C&&C.color===r)if(C.type!==o||!0!==v&&v!==o){if(!0===v||v===C.type)for(var _=0,A=l[C.type].length;_<A;_++){var k=l[C.type][_];for(I=E;!(136&(I+=k));){if(null!=m[I]){if(m[I].color===r)break;t(m,n,E,I,d.CAPTURE);break}if(t(m,n,E,I,d.NORMAL),"n"===C.type||"k"===C.type)break}}}else{var I=E+a[r][0];if(null==m[I]){t(m,n,E,I,d.NORMAL);I=E+a[r][1];u[r]===Z(E)&&null==m[I]&&t(m,n,E,I,d.BIG_PAWN)}for(_=2;_<4;_++)136&(I=E+a[r][_])||(null!=m[I]&&m[I].color===s?t(m,n,E,I,d.CAPTURE):I===S&&t(m,n,E,S,d.EP_CAPTURE))}}if(!(!0!==v&&v!==i||p&&f!==y[r])){if(w[r]&d.KSIDE_CASTLE){var R=(T=y[r])+2;null!=m[T+1]||null!=m[R]||$(s,y[r])||$(s,T+1)||$(s,R)||t(m,n,y[r],R,d.KSIDE_CASTLE)}var T;if(w[r]&d.QSIDE_CASTLE)R=(T=y[r])-2,null!=m[T-1]||null!=m[T-2]||null!=m[T-3]||$(s,y[r])||$(s,T-1)||$(s,R)||t(m,n,y[r],R,d.QSIDE_CASTLE)}if(!g)return n;var P=[];for(E=0,A=n.length;E<A;E++)Y(n[E]),B(r)||P.push(n[E]),z();return P}function Q(e,t){var n="";if(e.flags&d.KSIDE_CASTLE)n="O-O";else if(e.flags&d.QSIDE_CASTLE)n="O-O-O";else{if(e.piece!==o){var r=function(e,t){for(var n=e.from,r=e.to,o=e.piece,i=0,s=0,u=0,a=0,l=t.length;a<l;a++){var c=t[a].from,f=t[a].to;o===t[a].piece&&n!==c&&r===f&&(i++,Z(n)===Z(c)&&s++,V(n)===V(c)&&u++)}return i>0?s>0&&u>0?J(n):u>0?J(n).charAt(1):J(n).charAt(0):""}(e,t);n+=e.piece.toUpperCase()+r}e.flags&(d.CAPTURE|d.EP_CAPTURE)&&(e.piece===o&&(n+=J(e.from)[0]),n+="x"),n+=J(e.to),e.flags&d.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return Y(e),j()&&(G()?n+="#":n+="+"),z(),n}function K(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function $(e,r){for(var i=h.a8;i<=h.h1;i++)if(136&i)i+=7;else if(null!=m[i]&&m[i].color===e){var s=m[i],u=i-r,a=u+119;if(c[a]&1<<p[s.type]){if(s.type===o){if(u>0){if(s.color===n)return!0}else if(s.color===t)return!0;continue}if("n"===s.type||"k"===s.type)return!0;for(var l=f[a],g=i+l,d=!1;g!==r;){if(null!=m[g]){d=!0;break}g+=l}if(!d)return!0}}return!1}function B(e){return $(ee(e),y[e])}function j(){return B(b)}function G(){return j()&&0===U().length}function W(){return!j()&&0===U().length}function F(){for(var e={},t=[],n=0,r=0,o=h.a8;o<=h.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=m[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,"b"===i.type&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e.b||1===e.n))return!0;if(n===e.b+2){var s=0,u=t.length;for(o=0;o<u;o++)s+=t[o];if(0===s||s===u)return!0}return!1}function X(){for(var e=[],t={},n=!1;;){var r=z();if(!r)break;e.push(r)}for(;;){var o=x().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;Y(e.pop())}return n}function Y(e){var n=b,s=ee(n);if(function(e){_.push({move:e,kings:{b:y.b,w:y.w},turn:b,castling:{b:w.b,w:w.w},ep_square:S,half_moves:E,move_number:C})}(e),m[e.to]=m[e.from],m[e.from]=null,e.flags&d.EP_CAPTURE&&(b===t?m[e.to-16]=null:m[e.to+16]=null),e.flags&d.PROMOTION&&(m[e.to]={type:e.promotion,color:n}),m[e.to].type===i){if(y[m[e.to].color]=e.to,e.flags&d.KSIDE_CASTLE){var u=e.to-1,a=e.to+1;m[u]=m[a],m[a]=null}else e.flags&d.QSIDE_CASTLE&&(u=e.to+1,a=e.to-2,m[u]=m[a],m[a]=null);w[n]=""}if(w[n])for(var l=0,c=v[n].length;l<c;l++)if(e.from===v[n][l].square&&w[n]&v[n][l].flag){w[n]^=v[n][l].flag;break}if(w[s])for(l=0,c=v[s].length;l<c;l++)if(e.to===v[s][l].square&&w[s]&v[s][l].flag){w[s]^=v[s][l].flag;break}S=e.flags&d.BIG_PAWN?"b"===b?e.to-16:e.to+16:r,e.piece===o||e.flags&(d.CAPTURE|d.EP_CAPTURE)?E=0:E++,b===t&&C++,b=ee(b)}function z(){var e=_.pop();if(null==e)return null;var n=e.move;y=e.kings,b=e.turn,w=e.castling,S=e.ep_square,E=e.half_moves,C=e.move_number;var r,i,s=b,u=ee(b);if(m[n.from]=m[n.to],m[n.from].type=n.piece,m[n.to]=null,n.flags&d.CAPTURE)m[n.to]={type:n.captured,color:u};else if(n.flags&d.EP_CAPTURE){var a;a=s===t?n.to-16:n.to+16,m[a]={type:o,color:u}}return n.flags&(d.KSIDE_CASTLE|d.QSIDE_CASTLE)&&(n.flags&d.KSIDE_CASTLE?(r=n.to+1,i=n.to-1):n.flags&d.QSIDE_CASTLE&&(r=n.to-2,i=n.to+1),m[r]=m[i],m[i]=null),n}function H(e,t){var n=K(e);if(t){var r=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var s=r[1],u=r[2],a=r[3],l=r[4]}var c=function(e){var t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return o}return"o"===(t=t.toLowerCase())?i:t}(n),f=null,p=U({legal:!0,piece:s||c});if(f=p,t){var g=U({legal:!1,piece:s||c});f=g}for(var d=0,v=f.length;d<v;d++){if(n===K(Q(f[d],p))||t&&n===K(Q(f[d],g)))return f[d];if(r&&(!s||s.toLowerCase()==f[d].piece)&&h[u]==f[d].from&&h[a]==f[d].to&&(!l||l.toLowerCase()==f[d].promotion))return f[d]}return null}function Z(e){return e>>4}function V(e){return 15&e}function J(e){var t=V(e),n=Z(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function ee(e){return e===n?t:n}function te(e){var t=ne(e);t.san=Q(t,U({legal:!0})),t.to=J(t.to),t.from=J(t.from);var n="";for(var r in d)d[r]&t.flags&&(n+=g[r]);return t.flags=n,t}function ne(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?ne(e[n]):e[n];return t}function re(e){return e.replace(/^\s+|\s+$/g,"")}function oe(e){for(var t=U({legal:!1}),n=0,r=b,o=0,i=t.length;o<i;o++)Y(t[o]),B(r)||(e-1>0?n+=oe(e-1):n++),z();return n}return P(void 0===e?s:e),{WHITE:n,BLACK:t,PAWN:o,KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:i,SQUARES:function(){for(var e=[],t=h.a8;t<=h.h1;t++)136&t?t+=7:e.push(J(t));return e}(),FLAGS:g,load:function(e){return P(e)},reset:function(){return T()},moves:function(e){for(var t=U(e),n=[],r=0,o=t.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?n.push(te(t[r])):n.push(Q(t[r],U({legal:!0})));return n},in_check:function(){return j()},in_checkmate:function(){return G()},in_stalemate:function(){return W()},in_draw:function(){return E>=100||W()||F()||X()},insufficient_material:function(){return F()},in_threefold_repetition:function(){return X()},game_over:function(){return E>=100||G()||W()||F()||X()},validate_fen:function(e){return q(e)},fen:function(){return x()},board:function(){for(var e=[],t=[],n=h.a8;n<=h.h1;n++)null==m[n]?t.push(null):t.push({type:m[n].type,color:m[n].color}),n+1&136&&(e.push(t),t=[],n+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var i in A)r.push("["+i+' "'+A[i]+'"]'+t),o=!0;o&&_.length&&r.push(t);for(var s=function(e){var t=k[x()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},u=[];_.length>0;)u.push(z());var a=[],l="";for(0===u.length&&a.push(s(""));u.length>0;){l=s(l);var c=u.pop();_.length||"b"!==c.color?"w"===c.color&&(l.length&&a.push(l),l=C+"."):l=C+". ...",l=l+" "+Q(c,U({legal:!1})),Y(c)}if(l.length&&a.push(s(l)),void 0!==A.Result&&a.push(A.Result),0===n)return r.join("")+a.join(" ");var f=function(){return r.length>0&&" "===r[r.length-1]&&(r.pop(),!0)},p=function(e,o){for(var i of o.split(" "))if(i){if(e+i.length>n){for(;f();)e--;r.push(t),e=0}r.push(i),e+=i.length,r.push(" "),e++}return f()&&e--,e},g=0;for(i=0;i<a.length;i++)g+a[i].length>n&&a[i].includes("{")?g=p(g,a[i]):(g+a[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(t),g=0):0!==i&&(r.push(" "),g++),r.push(a[i]),g+=a[i].length);return r.join("")},load_pgn:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy;function r(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+r(o)+")|.)*\\])(?:"+r(o)+"){2}"),s=i.test(e)?i.exec(e)[1]:"";T();var a=function(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(r(n))),s="",u="",a=0;a<i.length;a++)s=i[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),u=i[a].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),re(s).length>0&&(o[s]=u);return o}(s,t);for(var l in a)M([l,a[l]]);if(!("1"!==a.SetUp||"FEN"in a&&P(a.FEN,!0)))return!1;for(var c=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(r(o),"g")," ")).slice(1,e.length-1))}}`},f=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},p=e.replace(s,"").replace(new RegExp(`({[^}]*})+?|;([^${r(o)}]*)`,"g"),(function(e,t,n){return void 0!==t?c(t):" "+c(`{${n.slice(1)}}`)})).replace(new RegExp(r(o),"g")," "),g=/(\([^\(\)]+\))+?/g;g.test(p);)p=p.replace(g,"");var d=re(p=(p=(p=p.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));d=d.join(",").replace(/,,+/g,",").split(",");for(var h="",v=0;v<d.length-1;v++){var m=f(d[v]);if(void 0===m){if(null==(h=H(d[v],n)))return!1;Y(h)}else k[x()]=m}if(void 0!==(m=f(d[d.length-1]))&&(k[x()]=m,d.pop()),h=d[d.length-1],u.indexOf(h)>-1)(function(e){for(var t in e)return!0;return!1})(A)&&void 0===A.Result&&M(["Result",h]);else{if(null==(h=H(h,n)))return!1;Y(h)}return!0},header:function(){return M(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=h.a8;t<=h.h1;t++){if(0===V(t)&&(e+=" "+"87654321"[Z(t)]+" |"),null==m[t])e+=" . ";else{var r=m[t].type;e+=" "+(m[t].color===n?r.toUpperCase():r.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return(e+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return b},move:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof e)r=H(e,n);else if("object"==typeof e)for(var o=U(),i=0,s=o.length;i<s;i++)if(e.from===J(o[i].from)&&e.to===J(o[i].to)&&(!("promotion"in o[i])||e.promotion===o[i].promotion)){r=o[i];break}if(!r)return null;var u=te(r);return Y(r),u},undo:function(){var e=z();return e?te(e):null},clear:function(){return I()},put:function(e,t){return O(e,t)},get:function(e){return N(e)},remove:function(e){return function(e){var t=N(e);return m[h[e]]=null,t&&t.type===i&&(y[t.color]=r),L(x()),t}(e)},perft:function(e){return oe(e)},square_color:function(e){if(e in h){var t=h[e];return(Z(t)+V(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=(void 0!==e&&"verbose"in e&&e.verbose);_.length>0;)t.push(z());for(;t.length>0;){var o=t.pop();r?n.push(te(o)):n.push(Q(o,U({legal:!0}))),Y(o)}return n},get_comment:function(){return k[x()]},set_comment:function(e){k[x()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=k[x()];return delete k[x()],e},get_comments:function(){return R(),Object.keys(k).map((function(e){return{fen:e,comment:k[e]}}))},delete_comments:function(){return R(),Object.keys(k).map((function(e){var t=k[e];return delete k[e],{fen:e,comment:t}}))}}};t.Chess=o,void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{constructor(e,t){this.row=e,this.column=t}toChessSquareString(){return String.fromCharCode("a".charCodeAt(0)+this.column)+(8-this.row)}getRow(){return this.row}getColumn(){return this.column}static fromRowAndColumn(t,n){return new e(t,n)}static fromSquare(t){const n=t.charCodeAt(0)-"a".charCodeAt(0),r=8-parseInt(t[1]);return new e(r,n)}}const t=e=>60*parseInt(e.split(":")[0])+parseInt(e.split(":")[1]),r=e=>{if(e>36)throw new Error("Does not support generating random string of length > 36");return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,e)},o=()=>{return e=void 0,t=void 0,r=function*(){return new Promise((e=>{chrome.storage.local.get(["extensionActive","depthValue","maxWaitTime","newgame","automove","autoPlayNewGame","bongcloud","voice"],(t=>{e(t)}))}))},new((n=void 0)||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}));var e,t,n,r},i=(e,t,n)=>{chrome.runtime.sendMessage({eventPlease:"trusted",x:e,y:t,mouse:n},(function(e){}))},s=(e,t,n,r,o,i)=>{const s=i/8,u=s/2;let a,l,c,f;return"white"===n?(a=r+s*(e.getColumn()+1)-u,l=o+i-s*(8-e.getRow())+u,c=r+s*(t.getColumn()+1)-u,f=o+i-s*(8-t.getRow())+u):(a=r+s*(8-e.getColumn())-u,l=o+i-s*(e.getRow()+1)+u,c=r+s*(8-t.getColumn())-u,f=o+i-s*(t.getRow()+1)+u),{startX:a,startY:l,endX:c,endY:f}},u=(e,t,n,r,o,i)=>{const s=i/8,u=s/2;let a=0,l=0;const c=(e=>{switch(e){case"q":return 0;case"k":return 1;case"b":return 2;case"r":default:return 3}})(t);return"white"===n?(a=r+s*(e.getColumn()+1)-u,l=o+i-s*(8-e.getRow()-c)+u):(a=r+s*(8-e.getColumn())-u,l=o+i-s*(e.getRow()+1-c)+u),{x:a,y:l}};class a{constructor(){this.RED_SQUARE_CLASS_NAME=r(20),this.getPlayerColour=()=>document.querySelector(".clock-bottom").classList.contains("clock-white")?"white":"black"}isMyTurn(){return!!document.querySelector(".clock-bottom")&&document.querySelector(".clock-bottom").classList.contains("clock-player-turn")}amIWhite(){return!!document.querySelector(".clock-bottom")&&document.querySelector(".clock-bottom").classList.contains("clock-white")}getMyTimeInSeconds(){const e=document.querySelector(".clock-bottom");if(e){const n=e.querySelector("span").innerText;return t(n)}return-1}getOpponentTimeInSeconds(){const e=document.querySelector(".clock-top");if(e){const n=e.querySelector("span").innerText;return t(n)}return-1}makeMove(e,t){const n=this.getPlayerColour(),r=document.querySelector(".board"),{left:o,top:u,width:a}=r.getBoundingClientRect(),{startX:l,startY:c,endX:f,endY:p}=s(e,t,n,o,u,a);i(l,c,"D"),i(l,c,"U"),i(f,p,"D"),i(f,p,"U")}promote(e,t){const n=this.getPlayerColour(),r=document.querySelector(".board"),{left:o,top:s,width:a}=r.getBoundingClientRect(),{x:l,y:c}=u(e,t,n,o,s,a);i(l,c,"D"),i(l,c,"U")}draw(e){const t=this.getPlayerColour(),n=document.querySelector(".board"),r=document.createElement("div");r.style.display="block",r.style.position="absolute","white"===t?(r.style.top=12.5*e.getRow()+"%",r.style.left=12.5*e.getColumn()+"%"):(r.style.top=12.5*(7-e.getRow())+"%",r.style.left=12.5*(7-e.getColumn())+"%"),r.style.background="rgba(255, 0, 0, 0.4)",r.style.height="12.5%",r.style.width="12.5%",r.className=this.RED_SQUARE_CLASS_NAME,n.appendChild(r)}clearAllDrawings(){document.querySelectorAll(`.${this.RED_SQUARE_CLASS_NAME}`).forEach((e=>e.remove()))}onNewMove(e){const t=document.querySelector(".clock-bottom");if(t){let n=t.className.includes("clock-player-turn");setInterval((()=>{const t=document.querySelector(".clock-bottom").className.includes("clock-player-turn");n!==t&&(n=t,e())}),50)}}getPgn(e,t){const n=e.indexOf("=");return-1!=n?e.substring(0,n+1)+t+e.substring(n+1):t+e}getAllMoves(){const e=document.querySelectorAll(".move");let t=[];return e.forEach((e=>{var n,r;const o=e.querySelector(".white");if(o&&o.textContent){const e=o.querySelector(".icon-font-chess");let r=o.textContent;if(e){const t=null!==(n=e.getAttribute("data-figurine"))&&void 0!==n?n:"";r=this.getPgn(r,t)}t.push(r)}const i=e.querySelector(".black");if(i&&i.textContent){const e=i.querySelector(".icon-font-chess");let n=i.textContent;if(e){const t=null!==(r=e.getAttribute("data-figurine"))&&void 0!==r?r:"";n=this.getPgn(n,t)}t.push(n)}})),t}tryToStartNewGame(){var e,t;const n=[...document.querySelector(".live-game-buttons-game-over").children][0];(null===(t=null===(e=n.lastChild)||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.includes("New"))&&n.click()}}const l=e=>{chrome.runtime.sendMessage(e)};var c=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};class f{constructor(){var e;this.backgroundMessage="",this.currentDepth="",this.currentRound=0,e=e=>{if("stockfish"===e.type&&(e.message.includes("pv")||e.message.includes("bestmove")))return this.backgroundMessage=e.message,this.currentRound=e.round,e},chrome.runtime.onMessage.addListener(((t,n,r)=>{e(t)}))}startNewGame(){chrome.runtime.sendMessage({type:"stockfish",message:"uci"})}getBestMove(e,t){return c(this,void 0,void 0,(function*(){return this.currentRound++,l({type:"stockfish",message:"stop"}),l({type:"stockfish",message:`go depth ${t}`,position:`position fen ${e}`}),new Promise(((e,t)=>{const n=this.currentRound,r=setInterval((()=>{if(this.currentRound>n&&(clearInterval(r),e("")),"bestmove"===this.backgroundMessage.substring(0,8)){const t=this.backgroundMessage.split(" "),n=t.indexOf("bestmove")+1,o=t[n];clearInterval(r),e(o)}}),100)}))}))}keepFindingBestMove(e,t,n){return c(this,void 0,void 0,(function*(){this.currentRound++,l({type:"stockfish",message:"stop"}),l({type:"stockfish",message:`go depth ${t}`,position:`position fen ${e}`});const r=setInterval((()=>{const e=this.currentRound;this.currentRound>e&&(clearInterval(r),n(""));let t=this.backgroundMessage.split(" ");const o=t.indexOf("depth")+1;let i=0,s="";this.backgroundMessage.includes("pv")&&this.currentDepth!==t[o]?(i=t.indexOf("pv")+1,this.currentDepth=t[o],s=t[i]):"bestmove"===this.backgroundMessage.substring(0,8)&&(i=t.indexOf("bestmove")+1,this.currentDepth="",s=t[i],clearInterval(r)),""!==s&&n(s)}),100)}))}stopAnalyzing(){return l({type:"stockfish",message:"stop"}),new Promise(((e,t)=>{const n=setInterval((()=>{if(""===this.backgroundMessage)clearInterval(n),e("TODO");else if("bestmove"===this.backgroundMessage.substring(0,8)){const t=this.backgroundMessage;this.backgroundMessage="",clearInterval(n),e(t)}}),100)}))}getEvaluation(e,t){return l({type:"stockfish",message:`go depth ${t}`,position:e,depth:t}),new Promise(((e,t)=>{const n=setInterval((()=>{if("info"===this.backgroundMessage.substring(0,4)){const t=this.backgroundMessage.split(" "),r=t.indexOf("score")+2,o=t[r];e(o),clearInterval(n)}}),100)}))}}var p=n(437),g=n.n(p);class d{constructor(){this.RED_SQUARE_CLASS_NAME=r(20),this.getPlayerColour=()=>document.querySelector(".cg-wrap").classList.contains("orientation-black")?"black":"white"}isMyTurn(){const e=document.querySelector(".rclock-bottom"),t=e.textContent,n=t.substring(t.length-2,t.length),r=document.querySelector("#main-wrap > main > div.round__app.variant-standard > div.expiration.expiration-bottom.bar-glider"),o=!!(r&&r.textContent&&r.textContent.includes("first move"));return e.classList.contains("running")||o||"00"===n}amIWhite(){return!1}getMyTimeInSeconds(){return 1e5}getOpponentTimeInSeconds(){return 1e5}makeMove(e,t){const n=this.getPlayerColour(),r=document.querySelector("cg-board"),{left:o,top:u,width:a}=r.getBoundingClientRect(),{startX:l,startY:c,endX:f,endY:p}=s(e,t,n,o,u,a);i(l,c,"D"),i(l,c,"U"),i(f,p,"D"),i(f,p,"U")}promote(e,t){const n=this.getPlayerColour(),r=document.querySelector("cg-board"),{left:o,top:s,width:a}=r.getBoundingClientRect(),{x:l,y:c}=u(e,t,n,o,s,a);i(l,c,"D"),i(l,c,"U")}draw(e){}clearAllDrawings(){}onNewMove(e){let t=this.getAllMoves().length;window.setInterval((()=>{const n=this.getAllMoves().length;n!==t&&(t=n,e())}),50)}getAllMoves(){var e,t,n;const r=document.querySelector(".flip"),o=null!==(n=null===(t=null===(e=null==r?void 0:r.parentElement)||void 0===e?void 0:e.nextElementSibling)||void 0===t?void 0:t.childNodes)&&void 0!==n?n:[],i=[];return o.forEach((e=>{e.textContent&&e.textContent.length>1&&i.push(e.textContent)})),i}tryToStartNewGame(){const e=document.querySelector("#main-wrap > main > div.round__app.variant-standard > div.rcontrols > div > a:nth-child(2)");e&&"New opponent"===e.textContent&&e.click()}}var h=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};chrome.runtime.onMessage.addListener((function(e){"start"===e.type?l({type:"start"}):"pause"===e.type&&l({type:"pause"})}));const v=(t,n)=>h(void 0,void 0,void 0,(function*(){setTimeout((()=>h(void 0,void 0,void 0,(function*(){let{extensionActive:r,depthValue:i,maxWaitTime:s,automove:u,bongcloud:a,voice:l}=yield o();if(i||(i=10),!r)return;const c=t.getAllMoves(),f=new(g());c.forEach((e=>{f.move(e)}));let p=Math.random()*s,d="";a&&(d=((e,t)=>{if(t.amIWhite()){if(0===e)return"f2f3";if(2===e)return"e1f2"}else{if(1===e)return"f7f6";if(3===e)return"e8f7"}return""})(c.length,t)),""===d&&(d=yield n.getBestMove(f.fen(),i)),t.clearAllDrawings();const h=e.fromSquare(d.substring(0,2)),v=e.fromSquare(d.substring(2,4));if(t.isMyTurn()&&l&&4===d.length){const e=d.substring(0,2)+" to "+d.substring(2,4),t=new SpeechSynthesisUtterance(e);window.speechSynthesis.cancel(),window.speechSynthesis.speak(t),(e=>{chrome.storage.local.set({voiceMessage:e})})(e)}t.draw(h),t.draw(v),t.isMyTurn()&&u&&setTimeout((()=>{var e;t.makeMove(h,v),5===(e=d).length&&["q","b","k","r"].includes(e.substring(4))&&setTimeout((()=>{t.promote(v,d.substring(4))}),50)}),p)}))),100)}));setTimeout((()=>{h(void 0,void 0,void 0,(function*(){let e,t=new f;const n=window.location.href;if(n.includes("chess.com"))e=new a;else{if(!n.includes("lichess.org"))throw new Error("Unsupported website");e=new d}e.onNewMove((()=>v(e,t))),setTimeout((()=>{v(e,t)}),1200),setInterval((()=>h(void 0,void 0,void 0,(function*(){const{autoPlayNewGame:t}=yield o();t&&e.tryToStartNewGame()}))),1e3),chrome.runtime.onMessage.addListener((function(n){"start"===n.type&&v(e,t)}))}))}),750),document.onkeydown=function(e){var t=window.event?event:e;81==t.keyCode&&t.ctrlKey&&chrome.storage.local.get(["voiceMessage"],(function(e){const t=e.voiceMessage,n=new SpeechSynthesisUtterance(t);window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)}))}})()})();